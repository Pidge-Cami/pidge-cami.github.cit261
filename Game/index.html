<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop</title>

</head>
<body>

<script>
//create canvans	
var canvas = document.createElement("canvas");
var ctx = canvas.getContext("2d");
canvas.width = 1000;
canvas.height = 1000;
document.body.appendChild(canvas);
	
	
//set background after loaded
var efReady = false;
var efImage = new Image();
efImage.onload = function () {
	efReady = true;
};
efImage.src = "image/EmondsField.jpg"; 
	
//Hopper Image
	
var hopperReady = false;
var hopperImage = new Image();
hopperImage.onload = function () {
	hopperReady = true;
};
hopperImage.src = "image/hopper.png" ;
	
//White Cloak Image
	
var wcReady = false;
var wcImage = new Image();
wcImage.onload = function(){
	wcReady = true;	
	
};	
	
wcImage.src = "image/whiteCloaks.png";	
	
//Game Objects
	
var hopper = {
speed: 266, // movement in px per second
x:0,
y:0	
	
};
var whiteCloak = {
x: 0,
y: 0	
	
};
	
	
var eatWhiteCloak = 0;
	
	
function saveScore(){
console.log("Saving score: " + eatWhiteCloak);
localStorage.setItem("data", eatWhiteCloak);

    }

        function loadStoredValues() {
            document.getElementById("eatWhiteCloak").value = localStorage.getItem("data");
        }	
		

//keyboard controls
	
var keysDown = {};
	
addEventListener("keydown", function(e){
	keysDown[e.keyCode] = true;
	
}, false);	
	
addEventListener("keyup", function(e) {
	delete keysDown[e.keyCode];
	
}, false);	
	
	
//reset the game when a White Cloak is eaten
	
var reset = function () {
hopper.x = canvas.width / 2;
hopper.y = canvas.height / 2;
	
	//randomly throw Whitecloak
	
	whiteCloak.x = 32 + (Math.random() * (canvas.width - 64));
	whiteCloak.y = 32 + (Math.random() * (canvas.height - 64));
	
};
	
	
// Update game objects
	
var update = function (modifier){
	
	if(38 in keysDown){
	hopper.y -= hopper.speed * modifier;		
	}
	if (40 in keysDown){
	hopper.y += hopper.speed * modifier;	
		
	}
	
	if(37 in keysDown){
	hopper.x -= hopper.speed * modifier;		
	}
	if (39 in keysDown){
	hopper.x += hopper.speed * modifier;	
		
	}	
	
//Hopper and White Cloak touching?
	
if(
hopper.x <= (whiteCloak.x+32)
&& whiteCloak.x <= (hopper.x +32)
&& hopper.y <=(whiteCloak.y+32)
&& whiteCloak.y <=(hopper.y +32)	
)
	{
	++eatWhiteCloak;
	saveScore();	
		reset();
	}
};
	
	
var render = function(){
	if (efReady){
	ctx.drawImage(efImage, 0, 0);	
		
	}
	
	if (hopperReady){
	ctx.drawImage(hopperImage, hopper.x, hopper.y);	
	}
	
	if (wcReady){
	ctx.drawImage(wcImage, whiteCloak.x, whiteCloak.y);	
	}


//Score	
	
	ctx.fillStyle = "azure";
	ctx.font = "24px Helvetica";
	ctx.textAlign = "left";
	ctx.textBaseline = "top";
	ctx.fillText("Hopper has eaten " + eatWhiteCloak + " White Cloaks", 32, 32);
};

	


var main = function () {
	var now = Date.now();
	var delta = now - then;

	update(delta / 1000);
	render();

	then = now;

	// Request to do this again ASAP
	requestAnimationFrame(main);
};
	
// Cross-browser support for requestAnimationFrame
var w = window;
requestAnimationFrame = w.requestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame || w.mozRequestAnimationFrame;	
	
// Starts Game
var then = Date.now();
reset();
main();	
	
	</script>
	
	
	
	

</body>
</html>